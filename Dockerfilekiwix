ARG VERSION=latest

# kiwix-tools is multi-arch
FROM ghcr.io/kiwix/kiwix-tools:$VERSION
LABEL org.opencontainers.image.source=https://github.com/openzim/kiwix-tools

# running as a named unprivileged user
RUN addgroup -S -g 1001 user && adduser -S -u 1001 user -G user

# ensure /data exists before changing ownership
RUN mkdir -p /data && chown user:user /data
USER user

COPY ./kiwixstart.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/kiwixstart.sh

ENTRYPOINT ["/usr/bin/dumb-init", "--", "/usr/local/bin/kiwixstart.sh"]
